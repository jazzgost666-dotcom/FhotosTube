<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FhotosTube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 480px; background: #000; min-height: 100vh; position: relative; border-left: 1px solid #1a1a1a; border-right: 1px solid #1a1a1a; display: flex; flex-direction: column; }
        .screen { display: none; flex-direction: column; flex: 1; animation: fadeIn 0.2s ease; }
        .active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .auth-input { background: #121212; border: 1px solid #333; color: white; padding: 15px; border-radius: 12px; width: 100%; margin-bottom: 10px; outline: none; }
        .btn-blue { background: #2563eb; color: white; font-weight: bold; padding: 14px; border-radius: 12px; width: 100%; }
        .grid-posts { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; }
        .grid-item { aspect-ratio: 1/1; background: #111; cursor: pointer; }
        .grid-item img { width: 100%; height: 100%; object-fit: cover; }
        #navBar { position: fixed; bottom: 0; width: 100%; max-width: 480px; background: #000; border-top: 1px solid #1a1a1a; height: 60px; display: flex; justify-content: space-around; items-center: center; z-index: 50; }
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="loginScreen" class="screen active justify-center p-8">
        <h1 class="text-4xl font-black text-blue-600 italic text-center mb-8">FhotosTube</h1>
        <input type="text" id="logUser" placeholder="Username" class="auth-input">
        <input type="password" id="logPass" placeholder="Password" class="auth-input">
        <button id="btnEntrar" class="btn-blue mb-4">ENTRAR</button>
        <p class="text-center text-gray-500 text-sm">Qualquer senha serve no primeiro acesso.</p>
    </div>

    <div id="feedScreen" class="screen">
        <header class="p-4 border-b border-gray-800 flex justify-between items-center bg-black sticky top-0 z-20">
            <span class="text-2xl font-black italic text-blue-600">FhotosTube</span>
        </header>
        <div id="feedList" class="flex-1 overflow-y-auto hide-scroll pb-20 p-2"></div>
    </div>

    <div id="profileScreen" class="screen">
        <div class="p-5 border-b border-gray-900">
            <div class="flex items-center gap-6 mb-4">
                <img id="pPic" src="" class="w-20 h-20 rounded-full object-cover border-2 border-blue-600">
                <div class="flex-1">
                    <h2 id="pNick" class="text-xl font-bold"></h2>
                    <button id="btnFollow" class="mt-2 text-xs font-bold px-4 py-1 rounded bg-blue-600 hidden">Seguir</button>
                    <button id="btnChat" class="mt-2 text-xs font-bold px-4 py-1 rounded bg-gray-800 hidden ml-2">Chat</button>
                </div>
            </div>
        </div>
        <div id="pGrid" class="grid-posts"></div>
    </div>

    <div id="postScreen" class="screen p-6">
        <h2 class="text-xl font-bold mb-4">Novo Post</h2>
        <input type="file" id="fileIn" accept="image/*" class="mb-4 text-sm">
        <img id="preView" src="" class="w-full rounded mb-4 hidden">
        <textarea id="postCap" placeholder="Legenda..." class="auth-input h-20"></textarea>
        <button id="btnPostar" class="btn-blue">PUBLICAR</button>
    </div>

    <div id="chatScreen" class="screen">
        <header class="p-4 border-b border-gray-800 flex items-center gap-4">
            <i class="fa-solid fa-arrow-left cursor-pointer" onclick="go('feedScreen')"></i>
            <span id="chatName" class="font-bold"></span>
        </header>
        <div id="chatBox" class="flex-1 overflow-y-auto p-4 space-y-2"></div>
        <div class="p-3 flex gap-2">
            <input type="text" id="chatMsg" class="auth-input mb-0 flex-1" placeholder="Mensagem...">
            <button id="btnSend" class="bg-blue-600 px-4 rounded-xl font-bold">></button>
        </div>
    </div>

    <nav id="navBar" class="hidden">
        <i class="fa-solid fa-house text-xl cursor-pointer" onclick="go('feedScreen')"></i>
        <i class="fa-solid fa-square-plus text-2xl cursor-pointer" onclick="go('postScreen')"></i>
        <i class="fa-solid fa-user text-xl cursor-pointer" id="myProfileBtn"></i>
    </nav>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAMHAKVot044psR421B_t-Ht5EmsueVS8A",
        authDomain: "game-dev-space.firebaseapp.com",
        databaseURL: "https://game-dev-space-default-rtdb.firebaseio.com",
        projectId: "game-dev-space",
        storageBucket: "game-dev-space.firebasestorage.app",
        appId: "1:1073185335190:web:ae9ffd88cdf89f53cbdfb7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let myId = localStorage.getItem('ft_uid') || 'u' + Date.now();
    localStorage.setItem('ft_uid', myId);
    
    let myData = { nick: '', pic: 'https://cdn-icons-png.flaticon.com/512/149/149071.png', following: {} };
    let chatAtivo = "";

    // Navegação
    window.go = (id) => {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id !== 'loginScreen') document.getElementById('navBar').classList.remove('hidden');
    };

    // Login Simples
    document.getElementById('btnEntrar').onclick = () => {
        const n = document.getElementById('logUser').value.trim();
        if(!n) return alert("Nick!");
        myData.nick = n;
        set(ref(db, 'users/' + myId), { nick: n, pic: myData.pic });
        go('feedScreen');
    };

    // Postar
    document.getElementById('fileIn').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            document.getElementById('preView').src = ev.target.result;
            document.getElementById('preView').classList.remove('hidden');
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    document.getElementById('btnPostar').onclick = () => {
        const img = document.getElementById('preView').src;
        const cap = document.getElementById('postCap').value;
        if(!img) return;
        push(ref(db, 'posts'), {
            uid: myId,
            nick: myData.nick,
            pic: myData.pic,
            img: img,
            cap: cap,
            time: Date.now()
        });
        go('feedScreen');
    };

    // Carregar Feed
    onValue(ref(db, 'posts'), (snap) => {
        const list = document.getElementById('feedList');
        list.innerHTML = "";
        const data = snap.val();
        if(!data) return;
        Object.keys(data).reverse().forEach(k => {
            const p = data[k];
            list.innerHTML += `
                <div class="mb-6 bg-zinc-900 rounded-xl overflow-hidden">
                    <div class="p-3 flex items-center gap-2 cursor-pointer" onclick="openProfile('${p.uid}')">
                        <img src="${p.pic}" class="w-8 h-8 rounded-full">
                        <span class="font-bold text-sm">${p.nick}</span>
                    </div>
                    <img src="${p.img}" class="w-full">
                    <div class="p-3">
                        <p class="text-sm"><b>${p.nick}</b> ${p.cap}</p>
                    </div>
                </div>`;
        });
    });

    // Abrir Perfil de Outros
    window.openProfile = (uid) => {
        onValue(ref(db, 'users/' + uid), (s) => {
            const u = s.val();
            document.getElementById('pNick').innerText = u.nick;
            document.getElementById('pPic').src = u.pic;
            document.getElementById('btnFollow').classList.toggle('hidden', uid === myId);
            document.getElementById('btnChat').classList.toggle('hidden', uid === myId);
            
            // Grid do usuário
            const grid = document.getElementById('pGrid');
            grid.innerHTML = "";
            onValue(ref(db, 'posts'), (sp) => {
                const ps = sp.val();
                if(ps) Object.values(ps).filter(x => x.uid === uid).forEach(p => {
                    grid.innerHTML += `<div class="grid-item"><img src="${p.img}"></div>`;
                });
            });

            document.getElementById('btnChat').onclick = () => {
                chatAtivo = uid;
                document.getElementById('chatName').innerText = u.nick;
                go('chatScreen');
                loadChat(uid);
            };

            go('profileScreen');
        }, { onlyOnce: true });
    };

    // Chat
    function loadChat(targetUid) {
        const chatId = myId < targetUid ? myId + targetUid : targetUid + myId;
        onValue(ref(db, 'chats/' + chatId), (s) => {
            const box = document.getElementById('chatBox');
            box.innerHTML = "";
            const msgs = s.val();
            if(msgs) Object.values(msgs).forEach(m => {
                const isMe = m.sender === myId;
                box.innerHTML += `<div class="flex ${isMe ? 'justify-end' : 'justify-start'}">
                    <span class="${isMe ? 'bg-blue-600' : 'bg-zinc-800'} px-3 py-1 rounded-lg text-sm">${m.text}</span>
                </div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    document.getElementById('btnSend').onclick = () => {
        const txt = document.getElementById('chatMsg').value;
        if(!txt || !chatAtivo) return;
        const chatId = myId < chatAtivo ? myId + chatAtivo : chatAtivo + myId;
        push(ref(db, 'chats/' + chatId), { sender: myId, text: txt });
        document.getElementById('chatMsg').value = "";
    };

    document.getElementById('myProfileBtn').onclick = () => openProfile(myId);

</script>
<script src="https://kit.fontawesome.com/your-code.js" crossorigin="anonymous"></script>
</body>
</html>
