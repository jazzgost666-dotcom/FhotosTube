<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FhotosTube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #fafafa; display: flex; justify-content: center; min-height: 100vh; font-family: 'Segoe UI', sans-serif; }
        .mobile-container { width: 100%; max-width: 450px; background: #fff; min-height: 100vh; position: relative; border-left: 1px solid #eee; border-right: 1px solid #eee; display: flex; flex-direction: column; }
        .page { display: none; flex-direction: column; flex: 1; width: 100%; text-align: center; }
        .page.active { display: flex; }
        .post-media { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #000; }
        .avatar-circle { width: 130px; height: 130px; border-radius: 50%; border: 4px solid #3b82f6; object-fit: cover; margin: 0 auto; }
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<div class="mobile-container">
    
    <div id="setupPage" class="page active items-center justify-center p-8">
        <h1 class="text-4xl font-extrabold mb-10 text-blue-600 italic">FhotosTube</h1>
        <div class="relative mb-8 cursor-pointer" onclick="document.getElementById('profilePicFile').click()">
            <img id="previewPic" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="avatar-circle">
            <div class="absolute bottom-2 right-2 bg-blue-500 text-white rounded-full p-2 border-4 border-white">
                <i class="fa-solid fa-plus"></i>
            </div>
            <input type="file" id="profilePicFile" accept="image/*" class="hidden">
        </div>
        <input type="text" id="userNick" placeholder="Escolha seu nick..." class="w-full border-b-2 border-gray-200 p-3 text-center text-2xl outline-none focus:border-blue-500 mb-10">
        <button onclick="iniciarApp()" class="bg-blue-600 text-white w-full py-4 rounded-2xl font-bold text-xl shadow-lg hover:bg-blue-700 transition">ENTRAR NO CANAL</button>
    </div>

    <div id="feedPage" class="page">
        <header class="p-4 border-b flex justify-between items-center sticky top-0 bg-white z-50">
            <span class="text-2xl font-black italic text-blue-600">FhotosTube</span>
            <i class="fa-solid fa-bolt text-xl text-yellow-500"></i>
        </header>
        <div id="feedList" class="flex-1 overflow-y-auto pb-24 hide-scroll"></div>
    </div>

    <div id="uploadPage" class="page p-6 items-center">
        <h2 class="text-2xl font-bold mb-8">Novo Post (Max 60s)</h2>
        <div class="w-full border-4 border-dashed border-gray-200 rounded-3xl p-12 text-center mb-6 bg-gray-50 relative cursor-pointer" onclick="document.getElementById('postFile').click()">
            <i class="fa-solid fa-clapperboard text-5xl text-blue-300 mb-4"></i>
            <p id="fileName" class="text-gray-500 font-medium text-sm">Toque para selecionar</p>
            <input type="file" id="postFile" accept="image/*,video/*" class="hidden">
        </div>
        <textarea id="postCap" placeholder="O que você está pensando?" class="w-full border-2 border-gray-100 p-4 rounded-2xl h-32 mb-6 outline-none focus:border-blue-500 text-lg"></textarea>
        <button id="btnPost" onclick="postarConteudo()" class="bg-blue-600 text-white w-full py-4 rounded-2xl font-bold text-xl active:scale-95">PUBLICAR AGORA</button>
    </div>

    <div id="profilePage" class="page p-6 items-center">
        <div class="w-full flex flex-col items-center">
            <img id="pPic" src="" class="avatar-circle mb-4 border-gray-200">
            <h2 id="pNick" class="text-2xl font-bold mb-8"></h2>
            
            <div class="grid grid-cols-3 w-full border-y py-6 mb-10 text-center">
                <div><p class="font-bold text-xl" id="pPostCount">0</p><p class="text-xs text-gray-400 uppercase">Posts</p></div>
                <div><p class="font-bold text-xl" id="pLikes">0</p><p class="text-xs text-gray-400 uppercase">Curtidas</p></div>
                <div><p class="font-bold text-xl">0</p><p class="text-xs text-gray-400 uppercase">Amigos</p></div>
            </div>
            
            <button onclick="window.location.reload()" class="w-full bg-red-50 text-red-500 py-4 rounded-2xl font-bold">SAIR DO CANAL</button>
        </div>
    </div>

    <nav id="navBar" class="hidden fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[450px] bg-white border-t flex justify-around p-5 z-50 shadow-2xl">
        <i class="fa-solid fa-house text-2xl cursor-pointer" onclick="showTab('feedPage')"></i>
        <i class="fa-solid fa-circle-plus text-3xl text-blue-600 cursor-pointer" onclick="showTab('uploadPage')"></i>
        <i class="fa-solid fa-user text-2xl cursor-pointer" onclick="showTab('profilePage')"></i>
    </nav>

</div>

<script>
    let user = { nick: "", pic: "https://cdn-icons-png.flaticon.com/512/149/149071.png", likes: 0, posts: 0 };
    let postsDB = JSON.parse(localStorage.getItem('fhotostube_db')) || [];

    function showTab(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'profilePage') renderProfile();
        window.scrollTo(0,0);
    }

    document.getElementById('profilePicFile').onchange = e => {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
            document.getElementById('previewPic').src = reader.result;
            user.pic = reader.result;
        };
        reader.readAsDataURL(file);
    };

    function iniciarApp() {
        const nick = document.getElementById('userNick').value;
        if(!nick) return alert("Digite seu Nick!");
        user.nick = nick;
        document.getElementById('navBar').classList.remove('hidden');
        showTab('feedPage');
        renderFeed();
    }

    function postarConteudo() {
        const file = document.getElementById('postFile').files[0];
        const cap = document.getElementById('postCap').value;
        const btn = document.getElementById('btnPost');

        if(!file) return alert("Selecione um arquivo!");

        btn.innerText = "Processando...";
        btn.disabled = true;

        if(file.type.includes('video')) {
            const video = document.createElement('video');
            video.preload = 'metadata';
            video.onloadedmetadata = function() {
                window.URL.revokeObjectURL(video.src);
                if (video.duration > 61) {
                    alert("Vídeo muito longo! Máximo: 60 segundos.");
                    btn.innerText = "PUBLICAR AGORA";
                    btn.disabled = false;
                } else {
                    finalizarPost(file, cap, 'video');
                }
            }
            video.src = URL.createObjectURL(file);
        } else {
            finalizarPost(file, cap, 'photo');
        }
    }

    function finalizarPost(file, cap, type) {
        const reader = new FileReader();
        reader.onload = () => {
            try {
                const newPost = {
                    id: Date.now(),
                    nick: user.nick,
                    userPic: user.pic,
                    content: reader.result,
                    type: type,
                    caption: cap,
                    likes: 0,
                    comments: []
                };
                postsDB.unshift(newPost);
                localStorage.setItem('fhotostube_db', JSON.stringify(postsDB));
                user.posts++;
                
                alert("Publicado!");
                document.getElementById('postCap').value = "";
                document.getElementById('postFile').value = "";
                document.getElementById('fileName').innerText = "Toque para selecionar";
                document.getElementById('btnPost').innerText = "PUBLICAR AGORA";
                document.getElementById('btnPost').disabled = false;
                
                showTab('feedPage');
                renderFeed();
            } catch(e) {
                alert("Erro: O arquivo é muito grande para o navegador. Tente uma foto menor ou um vídeo mais curto.");
                document.getElementById('btnPost').innerText = "PUBLICAR AGORA";
                document.getElementById('btnPost').disabled = false;
            }
        };
        reader.readAsDataURL(file);
    }

    window.addComment = (postId) => {
        const input = document.getElementById(`cmnt-${postId}`);
        if(!input.value) return;
        const post = postsDB.find(p => p.id === postId);
        post.comments.push({ nick: user.nick, text: input.value });
        localStorage.setItem('fhotostube_db', JSON.stringify(postsDB));
        input.value = "";
        renderFeed();
    };

    function renderFeed() {
        const list = document.getElementById('feedList');
        if(postsDB.length === 0) {
            list.innerHTML = `<p class="mt-20 text-gray-400">Nenhum post ainda. Seja o primeiro!</p>`;
            return;
        }
        list.innerHTML = postsDB.map(p => `
            <div class="bg-white border-b-8 border-gray-50 text-left">
                <div class="p-4 flex items-center gap-3">
                    <img src="${p.userPic}" class="w-10 h-10 rounded-full object-cover">
                    <span class="font-bold text-sm text-gray-800">${p.nick}</span>
                </div>
                ${p.type === 'video' ? `<video src="${p.content}" class="post-media" controls></video>` : `<img src="${p.content}" class="post-media">`}
                <div class="p-4">
                    <div class="flex gap-4 mb-3">
                        <i class="fa-solid fa-heart text-2xl text-red-500"></i>
                        <i class="fa-regular fa-comment text-2xl"></i>
                    </div>
                    <p class="text-sm mb-3 text-gray-700"><b>${p.nick}</b> ${p.caption}</p>
                    <div class="bg-gray-50 rounded-xl p-3 mb-3 max-h-32 overflow-y-auto">
                        ${p.comments.map(c => `<p class="text-xs mb-1"><b>${c.nick}</b> ${c.text}</p>`).join('')}
                    </div>
                    <div class="flex gap-2">
                        <input id="cmnt-${p.id}" type="text" placeholder="Comentar..." class="flex-1 bg-gray-100 rounded-full px-4 py-2 text-xs outline-none">
                        <button onclick="addComment(${p.id})" class="text-blue-600 font-bold text-xs">OK</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function renderProfile() {
        document.getElementById('pNick').innerText = user.nick;
        document.getElementById('pPic').src = user.pic;
        document.getElementById('pPostCount').innerText = user.posts;
        document.getElementById('pLikes').innerText = user.likes;
    }

    document.getElementById('postFile').onchange = e => {
        if(e.target.files[0]) document.getElementById('fileName').innerText = e.target.files[0].name;
    };
</script>

</body>
</html>
